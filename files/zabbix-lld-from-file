#!/usr/bin/env python3
#
# Managed by ansible ({{ ansible_role_name }})
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
# Reads csv file and outputs valid Zabbix lld as json.
#
# - NAME
# - DISPLAY_NAME
#
# markus.meissner@meissner.IT
#
# - 2025-03-27: Initial release

import argparse
import csv
import json
import os

data = list()

parser = argparse.ArgumentParser()
parser.add_argument("csv_file")
# columns to parse might come in a future release
# parser.add_argument("columns")
args = parser.parse_args()

conffile = args.csv_file
if os.path.exists(conffile):
    with open(conffile) as csvfile:
        csvreader = csv.reader(csvfile)
        for row in csvreader:
            if len(row) > 0 and not row[0].startswith("#"):
                data.append(
                    {
                        "{#NAME}": row[0],
                        "{#DISPLAY_NAME}": row[1] if len(row) > 1 else row[0],
                    }
                )

print(json.dumps({"data": data}, indent=4))
